<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/record.css">
</head>

<body>
    <div class="root">
        <div class="head">
            <a class="title">個人資料</a>
        </div>
        <div class="footer">
        姓名：<input class= "info" id='name' type="text"><br>
        帳號：<input class= "info" id='account' type="text"><br>
        密碼：<input class= "info" id='password' type="text"><br>
        <button class="updatebtn" id='updatebtn'>
            <p>更新</p></button>
        </div>

        <div><a class="back">⇦</a></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
    <script src="./database/db.js"></script>
    <script>
        const updatebtn = document.querySelector('#updatebtn');
        const nametInput = document.querySelector('#name');
        const accountInput = document.querySelector('#account');
        const passwordInput = document.querySelector('#password');
        const fetchData = async () =>{
            const { account } = sessionStorage;

            const write = await DB_API.getUserdata(account);
            nametInput.value = write.name;
            accountInput.value = write.account;
            passwordInput.value = write.password;
            // console.log(write);               
        }
        fetchData();

        updatebtn.onclick = async () => {
            const { account } = sessionStorage;
            // const name = nametInput.value;
            // const account = accountInput.value;
            // const password = passwordInput.value;
            //確定輸入框都不是空的
            if(!account || !password)
                return alert('請輸入帳號跟密碼');
            
            const update = await DB_API.getUser(account,password);
            if(update) {
                const newData = {
                name:$('#name').val(),
                account:$('#account').val(),
                password:$('#password').val()
                };
                await DB_API.updateUsers(newData);
                alert('更改成功');
        }
                  
            // location.assign('./login.html', 2000);
            
        }
    </script>
</body>

</html>